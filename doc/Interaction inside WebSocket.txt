портируем игру Rock Paper Scissors in ICQ (RPS)
в Web на html5

основная идея: состояние хранится и на клиенте и на сервере, сервер авторитарен.
Клиент пересылает действия пользователя:
(+сгенерированную карту в самом начале)
Сдвинуться на клетку в любую сторону.
сервер смотрит, что происходит, меняет состояние игровой комнаты, если может, присылает резутьтат. или запрос на дополнительную информацию,
возвращает результат, который клиент отрисовывает.

+--------------------------------------------------------------------------------------------------------+
|           игрок 1                |            Сервер                |           игрок 2                |

|Приходит с валидной кукой
                                   |upgrade запроса, пометка 
                                   |пользователя как '1'
                                   |ставит в очередь
                                   |ждёт загрузки карны от пользователя.
|запрашивает у пользователя        
|конфигурацию синих персонажей 
|(координаты на фронте                                                 |приходит с валидной кукой
|всегда в нижней части экрана      |upgrade запроса, пометка 
|  0123456                         |пользователя как '2'
| 0RRRRRRR  red                                                        |запрашивает у пользователя
| 1RRRRRRR                                                             |конфигурацию тоже синих
| 2.......                         |объединяет с пользователем '1'     |персонажей
| 3.......                         |создаёт игровую комнату            |
| 4BBBBBBB  blue <--                                                   |
| 5BBBBBBB                                                             |отправляет конфигурацию 
|передаются [x, y]                                                     |персонажей 
|                                  |валидирует, отзеркаливает,
|                                  |загружает в карту
|
| отправляет                       |валидирует, не изменяет
| ставит loader                    |загружает в карту
                                   |проверяет, что оба игрока создали
                                   |команду, присылает полное состояние
                                   |обоим игрокам с учётом вращения
|принимает карту, уберает loader   |                                   |принимает карту, уберает loader
                                   |отправляет "ваш ход" первому                                    
|ставит синий флажок ваш ход       |отправляет "ход соперника"         
|ждёт пользователя                                                     |ставит красный флажок 
|                                                                      |ход соперника
|                                                                      
|пользователь нажимает на                                               
|персонажа, появляются стрелочки
|ползователь двигает персонажа
|клиент отсылает с какой кординаты
|в какую двигается пользователь
                                   |сервер смотрит, куда перемещается
                                   |персонаж.
                                   |предположим, целевая клетка пуста
                                   |перемещает персонажа на сервере
                                   |в комнате,
                                   |отправляет действие [move]
                                   |пользователю 1
|двигает персонажа в клетку        |отправляет действие [move]
|что в ответе сервера              |пользователю 2 (отзеркаливая
                                   |координаты)
                                                                       |двигает персонажа
                                   |отправляет "ваш ход" второму
|меняет флажок                     |отправляет "ход соперника" первому |меняет флажок
                                                                       |ждёт пользователя
                                                                       |
                                                                       |
                                                                       |пользователь двигает персонажа
                                                                       |клиент отсылает с какой кординаты
                                                                       |в какую двигается пользователь
                                   |сервер смотрит, куда перемещается
                                   |персонаж.
                                   |предположим, в целевой клетке враг
                                   |сервер проверяет первосходство
                                   |предметов персонажей
                                   |предположим, первый победил.
                                   |отправляет действие [attak]
                                   |(кто, кого, цвет обоих,
                                   |кто проиграл)первому
|отрисовывает анимацию,            |отправляет действие [attak]
|убирает одного персонажа          |(кто, кого, цвет обоих,
                                   |кто проиграл)второму
                                   |отправляет обновление оружия       |отрисовывает анимацию,            
                                   |первому                            |убирает одного персонажа
|обновляет оружие персонажа
                                   |отправляет "ваш ход" первому                                    
|ставит синий флажок ваш ход       |отправляет "ход соперника"         
|ждёт пользователя                                                     |ставит красный флажок 
|                                                                      |ход соперника
|
|ползователь двигает персонажа                                         
|клиент отсылает с какой кординаты                                     
                                   |сервер смотрит, куда перемещается
                                   |персонаж.
                                   |предположим, в целевой клетке 
                                   |такой же персонаж, или координаты
                                   |невалидны.
                                   |сервер отсылает заново состояние 
                                   |игровой комнаты, думая, что
                                   |произошло рассогласование
|сверяет/перерисовывает поле
|пользователь пытается ещё раз 
|сходить                         
                                   |сервер смотрит, куда перемещается
                                   |персонаж.
                                   |предположим, в целевой клетке враг
                                   |сервер проверяет первосходство
                                   |предметов персонажей
                                   |предположим, что равные предметы
                                   |
                                   |отправляет обновление оружия врага         
                                   |первому                                   
                                   |// это целый дополнительный экран
                                   |// добавим выбор потом, если успеем
                                   |// равно как и ловушку
                                   |отправляет "ваш ход" второму
                                   |отправляет "ход соперника" первому |меняет флажок
|меняет флажок                                                         |ждёт пользователя
                                                                       |
                                                                       |
                                                                       |ползователь двигает персонажа
                                                                       |клиент отсылает с какой кординаты
                                                                       |в какую двигается пользователь 
                                   |сервер смотрит, куда перемещается
                                   |персонаж.
                                   |предположим, оружие врага - флаг
                                   |отсылает действие [gameover]
|отрисовывает менюшку поражения    |(кто победил) первому
|кнопку "играть снова"             |отсылает действие [gameover]
                                   |(кто победил) второму              |отрисовывает менюшку выигрыша,
                                   |уничтожает игровую комнату         |кнопку ещё раз.
                                   |закрывает соединение. 
+--------------------------------------------------------------------------------------------------------+

карта в представлении сервера
массив 6*7 указателей на персонажей, может быть нулевым для пустой клетки.

персонаж {
    принадлежность [1, 2]
    оружие [камень, ножницы, бумага, флаг] // флаг как оружие, которое всегда проигрывает
    спалил ли оружие перед соперником
}
"статус" комнаты, возвращаемый при инициализации.
содержит информацию сервера, но без оружия соперника, если он ещё не принимал участие,
и повёрнутую для второго игрока

for x := 0; x<=6; x++{                        //   0123456
    for y := 0; y <= 5; y++{                  // 0 ABCDEFG
        user2Map[x][y] = serverMap[6-x][5-y]  // 1 HIJKLMN
    }                                         // 2 OPQRSTU
}                                             // 3 utsrqpo
                                              // 4 nmlkjih
                                              // 5 gfedcba


Список ручек, которые необходимо реализовать.

JSON RPC сервера, за которые дёргает клиент.
установление соединения к игре, http:///game/v1/instance1
пользователь заходит в игру.
посылается запрос WebSocket.
сервер проверяет куку
если уже есть соответствие кука - (игровая комната, номер игрока), 
то upgrade соединения до websocket и перебрасывается в эту комнату.
ему присылается [статус] целеком, он включается в игру.
если пока кука не задействована и она валидна
соединение upgrade и передаётся в конструктор комнат



внутри websocket:

первоначальная загрузка карты
"upload_map"
[[],[],[],[],[
{персонаж},
],[
{персонаж},
]]

движение персонажа
"character_movement"



клиента, за которые дёргает сервер
загрузка всей карты
"download_map"

установки статуса чей ход.
"your_turn" bool

TODO: Дописать запросы и полные примеры всех запросов.
